<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>module TimesheetsHelper - YOUR_TITLE</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/helpers/timesheets_helper.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-timesheethelp_actions">#timesheethelp_actions</a>
    
    <li><a href="#method-i-timesheethelp_always_visible_description">#timesheethelp_always_visible_description</a>
    
    <li><a href="#method-i-timesheethelp_commit_label">#timesheethelp_commit_label</a>
    
    <li><a href="#method-i-timesheethelp_committed_at">#timesheethelp_committed_at</a>
    
    <li><a href="#method-i-timesheethelp_hours">#timesheethelp_hours</a>
    
    <li><a href="#method-i-timesheethelp_owner">#timesheethelp_owner</a>
    
    <li><a href="#method-i-timesheethelp_task_selection">#timesheethelp_task_selection</a>
    
    <li><a href="#method-i-timesheethelp_tasks_for_addition">#timesheethelp_tasks_for_addition</a>
    
    <li><a href="#method-i-timesheethelp_updated_at">#timesheethelp_updated_at</a>
    
    <li><a href="#method-i-timesheethelp_week_selection">#timesheethelp_week_selection</a>
    
    <li><a href="#method-i-timesheethelp_year_chart">#timesheethelp_year_chart</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./TrackRecordReport.html">TrackRecordReport</a>
  
    <li><a href="./TrackRecordReport/Report.html">TrackRecordReport::Report</a>
  
    <li><a href="./TrackRecordReport/ReportCell.html">TrackRecordReport::ReportCell</a>
  
    <li><a href="./TrackRecordReport/ReportColumnTotal.html">TrackRecordReport::ReportColumnTotal</a>
  
    <li><a href="./TrackRecordReport/ReportElementaryCalculator.html">TrackRecordReport::ReportElementaryCalculator</a>
  
    <li><a href="./TrackRecordReport/ReportRow.html">TrackRecordReport::ReportRow</a>
  
    <li><a href="./TrackRecordReport/ReportSection.html">TrackRecordReport::ReportSection</a>
  
    <li><a href="./TrackRecordReport/ReportUserColumnTotal.html">TrackRecordReport::ReportUserColumnTotal</a>
  
    <li><a href="./TrackRecordReport/ReportUserData.html">TrackRecordReport::ReportUserData</a>
  
    <li><a href="./TrackRecordReport/ReportUserRowTotal.html">TrackRecordReport::ReportUserRowTotal</a>
  
    <li><a href="./ReportsHelper.html">ReportsHelper</a>
  
    <li><a href="./ReportsHelper/ReportMonth.html">ReportsHelper::ReportMonth</a>
  
    <li><a href="./ReportsHelper/ReportWeek.html">ReportsHelper::ReportWeek</a>
  
    <li><a href="./ReportsHelper/ReportYear.html">ReportsHelper::ReportYear</a>
  
    <li><a href="./QuietLeightbox.html">QuietLeightbox</a>
  
    <li><a href="./QuietLeightbox/ClassMethods.html">QuietLeightbox::ClassMethods</a>
  
    <li><a href="./QuietLeightbox/QuietLeightboxHelper.html">QuietLeightbox::QuietLeightboxHelper</a>
  
    <li><a href="./QuietPrototype.html">QuietPrototype</a>
  
    <li><a href="./QuietPrototype/ClassMethods.html">QuietPrototype::ClassMethods</a>
  
    <li><a href="./QuietPrototype/QuietPrototypeHelper.html">QuietPrototype::QuietPrototypeHelper</a>
  
    <li><a href="./YuiTree.html">YuiTree</a>
  
    <li><a href="./YuiTree/ClassMethods.html">YuiTree::ClassMethods</a>
  
    <li><a href="./YuiTree/YuiTreeHelper.html">YuiTree::YuiTreeHelper</a>
  
    <li><a href="./SafeInPlaceEditing.html">SafeInPlaceEditing</a>
  
    <li><a href="./SafeInPlaceEditing/ClassMethods.html">SafeInPlaceEditing::ClassMethods</a>
  
    <li><a href="./TrackRecordReportGenerator.html">TrackRecordReportGenerator</a>
  
    <li><a href="./TrackRecordReportGenerator/UkOrgPondCSV.html">TrackRecordReportGenerator::UkOrgPondCSV</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./AuditsController.html">AuditsController</a>
  
    <li><a href="./AuditsHelper.html">AuditsHelper</a>
  
    <li><a href="./ChartsController.html">ChartsController</a>
  
    <li><a href="./ChartsHelper.html">ChartsHelper</a>
  
    <li><a href="./ControlPanel.html">ControlPanel</a>
  
    <li><a href="./ControlPanelsController.html">ControlPanelsController</a>
  
    <li><a href="./Customer.html">Customer</a>
  
    <li><a href="./CustomersController.html">CustomersController</a>
  
    <li><a href="./CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="./EmailNotifier.html">EmailNotifier</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HelpHelper.html">HelpHelper</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectsController.html">ProjectsController</a>
  
    <li><a href="./ProjectsHelper.html">ProjectsHelper</a>
  
    <li><a href="./Rangeable.html">Rangeable</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SafeInPlaceEditingHelper.html">SafeInPlaceEditingHelper</a>
  
    <li><a href="./SavedReport.html">SavedReport</a>
  
    <li><a href="./SavedReportAutoTitlesController.html">SavedReportAutoTitlesController</a>
  
    <li><a href="./SavedReportsBaseController.html">SavedReportsBaseController</a>
  
    <li><a href="./SavedReportsByCustomerController.html">SavedReportsByCustomerController</a>
  
    <li><a href="./SavedReportsByProjectController.html">SavedReportsByProjectController</a>
  
    <li><a href="./SavedReportsByTaskController.html">SavedReportsByTaskController</a>
  
    <li><a href="./SavedReportsByUserController.html">SavedReportsByUserController</a>
  
    <li><a href="./SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="./SavedReportsCopyController.html">SavedReportsCopyController</a>
  
    <li><a href="./SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="./SessionsController.html">SessionsController</a>
  
    <li><a href="./Task.html">Task</a>
  
    <li><a href="./TaskGroup.html">TaskGroup</a>
  
    <li><a href="./TaskImport.html">TaskImport</a>
  
    <li><a href="./TaskImportsController.html">TaskImportsController</a>
  
    <li><a href="./TaskImportsHelper.html">TaskImportsHelper</a>
  
    <li><a href="./TasksController.html">TasksController</a>
  
    <li><a href="./TasksHelper.html">TasksHelper</a>
  
    <li><a href="./Timesheet.html">Timesheet</a>
  
    <li><a href="./TimesheetForceCommit.html">TimesheetForceCommit</a>
  
    <li><a href="./TimesheetForceCommitsController.html">TimesheetForceCommitsController</a>
  
    <li><a href="./TimesheetRow.html">TimesheetRow</a>
  
    <li><a href="./TimesheetRowsController.html">TimesheetRowsController</a>
  
    <li><a href="./TimesheetRowsHelper.html">TimesheetRowsHelper</a>
  
    <li><a href="./TimesheetsController.html">TimesheetsController</a>
  
    <li><a href="./TimesheetsHelper.html">TimesheetsHelper</a>
  
    <li><a href="./TrackRecordSections.html">TrackRecordSections</a>
  
    <li><a href="./TreesController.html">TreesController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WorkPacket.html">WorkPacket</a>
  
    <li><a href="./WorkPacketsController.html">WorkPacketsController</a>
  
    <li><a href="./WorkPacketsHelper.html">WorkPacketsHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module TimesheetsHelper</h1>

  <div id="description" class="description">
    <dl class="rdoc-list note-list"><dt>File
<dd>
<p>timesheets_helper.rb</p>
</dd><dt>(C)
<dd>
<p>Hipposoft 2008</p>
</dd><dt>Purpose
<dd>
<p>Support functions for views related to <a
href="Timesheet.html">Timesheet</a> objects. See
controllers/timesheets_controller.rb for more.</p>
</dd></dl>
<hr style="height: 10px">

<pre>07-Jan-2008 (ADH): Created.</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-timesheethelp_actions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_actions</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return appropriate list view actions for the given timesheet</p>
          

          
          <div class="method-source-code" id="timesheethelp_actions-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_actions</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-keyword">if</span> ( <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">admin?</span> )
    <span class="ruby-keyword">return</span> [ <span class="ruby-string">'edit'</span>, <span class="ruby-string">'delete'</span>, <span class="ruby-string">'show'</span> ]
  <span class="ruby-keyword">elsif</span> ( <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">manager?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span> )
    <span class="ruby-keyword">return</span> [ <span class="ruby-string">'show'</span>         ] <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
    <span class="ruby-keyword">return</span> [ <span class="ruby-string">'edit'</span>, <span class="ruby-string">'show'</span> ]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> []
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_actions-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_actions-method -->

    
      <div id="method-i-timesheethelp_always_visible_description" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_always_visible_description</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return the timesheet description, or ‘None’ if it is empty.</p>
          

          
          <div class="method-source-code" id="timesheethelp_always_visible_description-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_always_visible_description</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">description</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">description</span>.<span class="ruby-identifier">empty?</span> )
    <span class="ruby-identifier">des</span> = <span class="ruby-string">'None'</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">des</span> = <span class="ruby-identifier">h</span>( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">description</span> )
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">des</span>.<span class="ruby-identifier">html_safe</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_always_visible_description-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_always_visible_description-method -->

    
      <div id="method-i-timesheethelp_commit_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_commit_label</span><span
            class="method-args">( timesheet, committed = nil )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Output HTML suitable as a label to show whether or not the given timesheet
is committed or otherwise. The second parameter lets you override the given
timesheet and force the generation of a committed (pass ‘true’) or not
committed (pass ‘false’) label.</p>
          

          
          <div class="method-source-code" id="timesheethelp_commit_label-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_commit_label</span>( <span class="ruby-identifier">timesheet</span>, <span class="ruby-identifier">committed</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-identifier">committed</span> = <span class="ruby-ivar">@timesheet</span>.<span class="ruby-identifier">committed</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">committed</span>.<span class="ruby-identifier">nil?</span> )
  <span class="ruby-keyword">return</span> (
    <span class="ruby-identifier">committed</span> <span class="ruby-operator">?</span> <span class="ruby-string">'&lt;span class=&quot;timesheet_committed&quot;&gt;Committed&lt;/span&gt;'</span> <span class="ruby-operator">:</span>
                <span class="ruby-string">'&lt;span class=&quot;timesheet_not_committed&quot;&gt;Not Committed&lt;/span&gt;'</span>
  ).<span class="ruby-identifier">html_safe</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_commit_label-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_commit_label-method -->

    
      <div id="method-i-timesheethelp_committed_at" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_committed_at</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>List helper - formatted ‘committed at’ date for the given timesheet</p>
          

          
          <div class="method-source-code" id="timesheethelp_committed_at-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 225</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_committed_at</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">apphelp_date</span>( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed_at</span> )
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">'Not committed'</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_committed_at-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_committed_at-method -->

    
      <div id="method-i-timesheethelp_hours" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_hours</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>List helper - number of hours in total recorded in the given timesheet</p>
          

          
          <div class="method-source-code" id="timesheethelp_hours-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 235</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_hours</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">apphelp_string_hours</span>( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">total_sum</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-string">'-'</span>, <span class="ruby-string">'-'</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_hours-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_hours-method -->

    
      <div id="method-i-timesheethelp_owner" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_owner</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>List helper - owner of the given timesheet</p>
          

          
          <div class="method-source-code" id="timesheethelp_owner-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_owner</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">link_to</span>( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">user_path</span>( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">user</span> ) )
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_owner-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_owner-method -->

    
      <div id="method-i-timesheethelp_task_selection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_task_selection</span><span
            class="method-args">( form, tasks )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return HTML suitable for inclusion in the form passed in the first
parameter (i.e. the ‘f’ in “form for … do |f|” ), based on the task array
given in the second parameter, which provides:</p>
<ul><li>
<p>A &lt;select&gt; tag with options listing all tasks not already used by
this timesheet.</p>
</li><li>
<p>An empty string if the timesheet already has rows for every task presently
stored in the system.</p>
</li></ul>
          

          
          <div class="method-source-code" id="timesheethelp_task_selection-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_task_selection</span>( <span class="ruby-identifier">form</span>, <span class="ruby-identifier">tasks</span> )
  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">empty?</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-string">''</span>.<span class="ruby-identifier">html_safe</span>()
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Task</span>.<span class="ruby-identifier">sort_by_augmented_title</span>( <span class="ruby-identifier">tasks</span> )

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">apphelp_collection_select</span>(
      <span class="ruby-identifier">form</span>,
      <span class="ruby-string">'task_ids'</span>,
      <span class="ruby-identifier">tasks</span>,
      <span class="ruby-value">:id</span>,
      <span class="ruby-value">:augmented_title</span>
    )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_task_selection-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_task_selection-method -->

    
      <div id="method-i-timesheethelp_tasks_for_addition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_tasks_for_addition</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return an array of tasks suitable for timesheet row addition. Will be empty
if all tasks are already included, or no tasks are available for any other
reason. Pass the timesheet of interest.</p>

<p>Note that tasks with no project, or tasks with a project with no customer,
are excluded from the list.</p>
          

          
          <div class="method-source-code" id="timesheethelp_tasks_for_addition-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_tasks_for_addition</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-identifier">tasks</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">active_permitted_tasks</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">tasks</span>

  <span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">reject</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">task</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">task</span>.<span class="ruby-identifier">project_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">task</span>.<span class="ruby-identifier">project</span>.<span class="ruby-identifier">customer_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_tasks_for_addition-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_tasks_for_addition-method -->

    
      <div id="method-i-timesheethelp_updated_at" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_updated_at</span><span
            class="method-args">( timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>List helper - formatted ‘updated at’ date for the given timesheet</p>
          

          
          <div class="method-source-code" id="timesheethelp_updated_at-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_updated_at</span>( <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">apphelp_date</span>( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">updated_at</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_updated_at-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_updated_at-method -->

    
      <div id="method-i-timesheethelp_week_selection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_week_selection</span><span
            class="method-args">( form, timesheet )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return HTML suitable for inclusion in the form passed in the first
parameter (i.e. the ‘f’ in “form for … do |f|” ), based on the timesheet
given in the second parameter, which provides:</p>
<ul><li>
<p>A &lt;select&gt; tag listing available week numbers, with dates, which may
be assigned to the timesheet.</p>
</li><li>
<p>An empty string if there are no free weeks - the edit view should never
have been shown, but never mind…!</p>
</li></ul>
          

          
          <div class="method-source-code" id="timesheethelp_week_selection-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_week_selection</span>( <span class="ruby-identifier">form</span>, <span class="ruby-identifier">timesheet</span> )
  <span class="ruby-identifier">weeks</span> = <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">unused_weeks</span>();

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">weeks</span>.<span class="ruby-identifier">empty?</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-string">''</span>.<span class="ruby-identifier">html_safe</span>()
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">form</span>.<span class="ruby-identifier">select</span>(
      <span class="ruby-value">:week_number</span>,
      <span class="ruby-identifier">weeks</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">week</span> <span class="ruby-operator">|</span>
        [
          <span class="ruby-node">&quot;Week #{ week } (#{ Timesheet.date_for( timesheet.year, week, TimesheetRow::FIRST_DAY ) })&quot;</span>,
          <span class="ruby-identifier">week</span>
        ]
      <span class="ruby-keyword">end</span>
    )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_week_selection-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_week_selection-method -->

    
      <div id="method-i-timesheethelp_year_chart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timesheethelp_year_chart</span><span
            class="method-args">( year )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return a year chart for the given year. This is a complete table of months
down the left and week numbers with dates of the first week in individual
cells along the monthly rows. Months indicate the month of the first day of
the week in that year, so in week 1 will often be for the previous year
(which is clearly indicated in the table). Cell colours indicate the
condition of a timesheet for each week with links to edit the existing
timesheets or create new timesheets as necessary.</p>
          

          
          <div class="method-source-code" id="timesheethelp_year_chart-source">
            <pre><span class="ruby-comment"># File app/helpers/timesheets_helper.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timesheethelp_year_chart</span>( <span class="ruby-identifier">year</span> )
  <span class="ruby-identifier">week_range</span> = <span class="ruby-value">1</span><span class="ruby-operator">..</span>( <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-identifier">year</span> ) )
  <span class="ruby-identifier">first_day</span>  = <span class="ruby-constant">TimesheetRow</span><span class="ruby-operator">::</span><span class="ruby-constant">FIRST_DAY</span>
  <span class="ruby-identifier">months</span>     = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-comment"># Compile a hash keyed by year/month number which points to arrays of</span>
  <span class="ruby-comment"># week numbers with start date. The length of each keyed entry indicates</span>
  <span class="ruby-comment"># the number of weeks in that month. Key names are sortable by default</span>
  <span class="ruby-comment"># sort function behaviour to provide a date-ascending list.</span>

  <span class="ruby-identifier">week_range</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">week</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">date_for</span>( <span class="ruby-identifier">year</span>, <span class="ruby-identifier">week</span>, <span class="ruby-identifier">first_day</span>, <span class="ruby-keyword">true</span> )
    <span class="ruby-identifier">key</span>        = <span class="ruby-node">&quot;#{ start_date.year }-%02i&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">month</span>
    <span class="ruby-identifier">data</span>       = { <span class="ruby-value">:week</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">week</span>, <span class="ruby-value">:start_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_date</span> }

    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">months</span>[ <span class="ruby-identifier">key</span> ].<span class="ruby-identifier">nil?</span> )
      <span class="ruby-identifier">months</span>[ <span class="ruby-identifier">key</span> ] = [ <span class="ruby-identifier">data</span> ]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">months</span>[ <span class="ruby-identifier">key</span> ].<span class="ruby-identifier">push</span>( <span class="ruby-identifier">data</span> )
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Now run through the collated data to build the chart, working on the</span>
  <span class="ruby-comment"># basis of the sorted keys in the hash for each row and a maximum of 5</span>
  <span class="ruby-comment"># weeks in any of those rows. Blank entries are put at the start of a</span>
  <span class="ruby-comment"># row to make up 5 columns in case there aren't that many weeks in that</span>
  <span class="ruby-comment"># particular month.</span>

  <span class="ruby-identifier">keys</span>      = <span class="ruby-identifier">months</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>
  <span class="ruby-identifier">row_class</span> = <span class="ruby-string">'even'</span>
  <span class="ruby-identifier">output</span>    = <span class="ruby-string">&quot;&lt;table class=\&quot;timesheet_chart\&quot;&gt;\n&quot;</span>
  <span class="ruby-identifier">output</span>   <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  &lt;tr&gt;&lt;th&gt;Month&lt;/th&gt;&lt;th colspan=\&quot;5\&quot;&gt;Week start date and number&lt;/th&gt;&lt;/tr&gt;\n&quot;</span>

  <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">data</span>      = <span class="ruby-identifier">months</span>[ <span class="ruby-identifier">key</span> ]
    <span class="ruby-identifier">row_start</span> = <span class="ruby-identifier">data</span>[ <span class="ruby-value">0</span> ][ <span class="ruby-value">:start_date</span> ]

    <span class="ruby-identifier">heading</span> = <span class="ruby-node">&quot;#{ Date::MONTHNAMES[ row_start.month ] } &quot;</span><span class="ruby-operator">&lt;&lt;</span>
              <span class="ruby-node">&quot;#{ row_start.year }&quot;</span>

    <span class="ruby-identifier">row_class</span> = ( <span class="ruby-identifier">row_class</span> <span class="ruby-operator">==</span> <span class="ruby-string">'even'</span> ) <span class="ruby-operator">?</span> <span class="ruby-string">'odd'</span> <span class="ruby-operator">:</span> <span class="ruby-string">'even'</span>
    <span class="ruby-identifier">row_class</span> = <span class="ruby-identifier">row_class</span> <span class="ruby-operator">+</span> <span class="ruby-string">' last'</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">last</span> )

    <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  &lt;tr class=\&quot;#{ row_class }\&quot;&gt;\n&quot;</span>
    <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;    &lt;td class=\&quot;timesheet_chart_month\&quot;&gt;#{ heading }&lt;/td&gt;\n&quot;</span>
    <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;    &lt;td&gt;&amp;nbsp;&lt;/td&gt;\n&quot;</span> * ( <span class="ruby-value">5</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> )

    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">week</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">timesheet</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">find_by_user_id_and_year_and_week_number</span>(
        <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>,
        <span class="ruby-identifier">year</span>,
        <span class="ruby-identifier">week</span>[ <span class="ruby-value">:week</span> ]
      )

      <span class="ruby-identifier">classnm</span> = <span class="ruby-string">'centred'</span>
      <span class="ruby-identifier">content</span> = <span class="ruby-node">&quot;#{ week[ :start_date ].day }&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
                <span class="ruby-node">&quot; #{ Date::ABBR_MONTHNAMES[ week[ :start_date ].month ] }&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
                <span class="ruby-node">&quot; (#{ week[ :week ] })&quot;</span>

      <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">timesheet</span> )
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
          <span class="ruby-identifier">classnm</span> = <span class="ruby-string">'centred committed'</span>
          <span class="ruby-identifier">content</span> = <span class="ruby-identifier">link_to</span>( <span class="ruby-identifier">content</span>.<span class="ruby-identifier">html_safe</span>(), <span class="ruby-identifier">timesheet_path</span>( <span class="ruby-identifier">timesheet</span> ) )
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">classnm</span> = <span class="ruby-string">'centred not_committed'</span>
          <span class="ruby-identifier">content</span> = <span class="ruby-identifier">link_to</span>( <span class="ruby-identifier">content</span>.<span class="ruby-identifier">html_safe</span>(), <span class="ruby-identifier">edit_timesheet_path</span>( <span class="ruby-identifier">timesheet</span> ) )
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">content</span> = <span class="ruby-identifier">button_to</span>(
          <span class="ruby-identifier">content</span>.<span class="ruby-identifier">html_safe</span>(),
          {
            <span class="ruby-value">:action</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:create</span>,
            <span class="ruby-value">:method</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:post</span>,
            <span class="ruby-value">:year</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">year</span>,
            <span class="ruby-value">:week_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">week</span>[ <span class="ruby-value">:week</span> ]
          }
        )
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;    &lt;td class=\&quot;#{ classnm }\&quot;&gt;#{ content }&lt;/td&gt;\n&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  &lt;/tr&gt;\n&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> ( <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'&lt;/table&gt;'</span> ).<span class="ruby-identifier">html_safe</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- timesheethelp_year_chart-source -->
          
        </div>

        

        
      </div><!-- timesheethelp_year_chart-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

