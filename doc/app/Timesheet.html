<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class Timesheet - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/timesheet.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-allowed_range">::allowed_range</a>
    
    <li><a href="#method-c-date_for">::date_for</a>
    
    <li><a href="#method-c-get_first_week_start">::get_first_week_start</a>
    
    <li><a href="#method-c-get_last_week_end">::get_last_week_end</a>
    
    <li><a href="#method-c-get_last_week_number">::get_last_week_number</a>
    
    <li><a href="#method-c-used_range">::used_range</a>
    
    <li><a href="#method-i-add_row">#add_row</a>
    
    <li><a href="#method-i-can_be_modified_by-3F">#can_be_modified_by?</a>
    
    <li><a href="#method-i-column_sum">#column_sum</a>
    
    <li><a href="#method-i-date_for">#date_for</a>
    
    <li><a href="#method-i-discover_week">#discover_week</a>
    
    <li><a href="#method-i-editable_week">#editable_week</a>
    
    <li><a href="#method-i-find_mine">#find_mine</a>
    
    <li><a href="#method-i-find_mine_committed">#find_mine_committed</a>
    
    <li><a href="#method-i-find_mine_uncommitted">#find_mine_uncommitted</a>
    
    <li><a href="#method-i-is_permitted_for-3F">#is_permitted_for?</a>
    
    <li><a href="#method-i-showable_week">#showable_week</a>
    
    <li><a href="#method-i-start_day">#start_day</a>
    
    <li><a href="#method-i-total_sum">#total_sum</a>
    
    <li><a href="#method-i-unused_weeks">#unused_weeks</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./TrackRecordReport.html">TrackRecordReport</a>
  
    <li><a href="./TrackRecordReport/Report.html">TrackRecordReport::Report</a>
  
    <li><a href="./TrackRecordReport/ReportCell.html">TrackRecordReport::ReportCell</a>
  
    <li><a href="./TrackRecordReport/ReportColumnTotal.html">TrackRecordReport::ReportColumnTotal</a>
  
    <li><a href="./TrackRecordReport/ReportElementaryCalculator.html">TrackRecordReport::ReportElementaryCalculator</a>
  
    <li><a href="./TrackRecordReport/ReportRow.html">TrackRecordReport::ReportRow</a>
  
    <li><a href="./TrackRecordReport/ReportSection.html">TrackRecordReport::ReportSection</a>
  
    <li><a href="./TrackRecordReport/ReportUserColumnTotal.html">TrackRecordReport::ReportUserColumnTotal</a>
  
    <li><a href="./TrackRecordReport/ReportUserData.html">TrackRecordReport::ReportUserData</a>
  
    <li><a href="./TrackRecordReport/ReportUserRowTotal.html">TrackRecordReport::ReportUserRowTotal</a>
  
    <li><a href="./ReportsHelper.html">ReportsHelper</a>
  
    <li><a href="./ReportsHelper/ReportMonth.html">ReportsHelper::ReportMonth</a>
  
    <li><a href="./ReportsHelper/ReportWeek.html">ReportsHelper::ReportWeek</a>
  
    <li><a href="./ReportsHelper/ReportYear.html">ReportsHelper::ReportYear</a>
  
    <li><a href="./QuietLeightbox.html">QuietLeightbox</a>
  
    <li><a href="./QuietLeightbox/ClassMethods.html">QuietLeightbox::ClassMethods</a>
  
    <li><a href="./QuietLeightbox/QuietLeightboxHelper.html">QuietLeightbox::QuietLeightboxHelper</a>
  
    <li><a href="./QuietPrototype.html">QuietPrototype</a>
  
    <li><a href="./QuietPrototype/ClassMethods.html">QuietPrototype::ClassMethods</a>
  
    <li><a href="./QuietPrototype/QuietPrototypeHelper.html">QuietPrototype::QuietPrototypeHelper</a>
  
    <li><a href="./YuiTree.html">YuiTree</a>
  
    <li><a href="./YuiTree/ClassMethods.html">YuiTree::ClassMethods</a>
  
    <li><a href="./YuiTree/YuiTreeHelper.html">YuiTree::YuiTreeHelper</a>
  
    <li><a href="./SafeInPlaceEditing.html">SafeInPlaceEditing</a>
  
    <li><a href="./SafeInPlaceEditing/ClassMethods.html">SafeInPlaceEditing::ClassMethods</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./AuditsController.html">AuditsController</a>
  
    <li><a href="./AuditsHelper.html">AuditsHelper</a>
  
    <li><a href="./ChartsController.html">ChartsController</a>
  
    <li><a href="./ChartsHelper.html">ChartsHelper</a>
  
    <li><a href="./ControlPanel.html">ControlPanel</a>
  
    <li><a href="./ControlPanelsController.html">ControlPanelsController</a>
  
    <li><a href="./Customer.html">Customer</a>
  
    <li><a href="./CustomersController.html">CustomersController</a>
  
    <li><a href="./CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="./EmailNotifier.html">EmailNotifier</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HelpHelper.html">HelpHelper</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectsController.html">ProjectsController</a>
  
    <li><a href="./ProjectsHelper.html">ProjectsHelper</a>
  
    <li><a href="./Rangeable.html">Rangeable</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SafeInPlaceEditingHelper.html">SafeInPlaceEditingHelper</a>
  
    <li><a href="./SavedReport.html">SavedReport</a>
  
    <li><a href="./SavedReportAutoTitlesController.html">SavedReportAutoTitlesController</a>
  
    <li><a href="./SavedReportsBaseController.html">SavedReportsBaseController</a>
  
    <li><a href="./SavedReportsByCustomerController.html">SavedReportsByCustomerController</a>
  
    <li><a href="./SavedReportsByProjectController.html">SavedReportsByProjectController</a>
  
    <li><a href="./SavedReportsByTaskController.html">SavedReportsByTaskController</a>
  
    <li><a href="./SavedReportsByUserController.html">SavedReportsByUserController</a>
  
    <li><a href="./SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="./SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="./SessionsController.html">SessionsController</a>
  
    <li><a href="./Task.html">Task</a>
  
    <li><a href="./TaskGroup.html">TaskGroup</a>
  
    <li><a href="./TaskImport.html">TaskImport</a>
  
    <li><a href="./TaskImportsController.html">TaskImportsController</a>
  
    <li><a href="./TaskImportsHelper.html">TaskImportsHelper</a>
  
    <li><a href="./TasksController.html">TasksController</a>
  
    <li><a href="./TasksHelper.html">TasksHelper</a>
  
    <li><a href="./Timesheet.html">Timesheet</a>
  
    <li><a href="./TimesheetRow.html">TimesheetRow</a>
  
    <li><a href="./TimesheetRowsController.html">TimesheetRowsController</a>
  
    <li><a href="./TimesheetRowsHelper.html">TimesheetRowsHelper</a>
  
    <li><a href="./TimesheetsController.html">TimesheetsController</a>
  
    <li><a href="./TimesheetsHelper.html">TimesheetsHelper</a>
  
    <li><a href="./TrackRecordSections.html">TrackRecordSections</a>
  
    <li><a href="./TreesController.html">TreesController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WorkPacket.html">WorkPacket</a>
  
    <li><a href="./WorkPacketsController.html">WorkPacketsController</a>
  
    <li><a href="./WorkPacketsHelper.html">WorkPacketsHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Timesheet</h1>

  <div id="description" class="description">
    <dl class="rdoc-list note-list"><dt>File
<dd>
<p>timesheet.rb</p>
</dd><dt>(C)
<dd>
<p>Hipposoft 2008</p>
</dd><dt>Purpose
<dd>
<p>Describe the behaviour of <a href="Timesheet.html">Timesheet</a> objects.
See below for more details.</p>
</dd></dl>
<hr style="height: 10px">

<pre>07-Jan-2008 (ADH): Created.</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="DEFAULT_SORT_COLUMN">DEFAULT_SORT_COLUMN
        
        <dd class="description">
        
      
        <dt id="DEFAULT_SORT_DIRECTION">DEFAULT_SORT_DIRECTION
        
        <dd class="description">
        
      
        <dt id="DEFAULT_SORT_ORDER">DEFAULT_SORT_ORDER
        
        <dd class="description">
        
      
        <dt id="USED_RANGE_COLUMN">USED_RANGE_COLUMN
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-allowed_range" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">allowed_range</span><span
            class="method-args">( accurate = false )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return a range of years allowed for a timesheet. Optionally pass ‘true’ if
you want an actual Date object range rather than just a year range.</p>
          

          
          <div class="method-source-code" id="allowed_range-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">allowed_range</span>( <span class="ruby-identifier">accurate</span> = <span class="ruby-keyword">false</span> )
  <span class="ruby-keyword">if</span> ( <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">significant</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">zero?</span> )
    <span class="ruby-identifier">range</span> = ( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span> )<span class="ruby-operator">..</span>( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span> )
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">range</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">used_range</span>
    <span class="ruby-identifier">range</span> = ( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span> )<span class="ruby-operator">..</span>( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span> )
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">accurate</span> )
    ( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">first</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span> ) )<span class="ruby-operator">..</span>( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">last</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> ) )
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">range</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- allowed_range-source -->
          
        </div>

        

        
      </div><!-- allowed_range-method -->

    
      <div id="method-c-date_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">date_for</span><span
            class="method-args">( year, week_number, day_number, as_date = false )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Class method; as <a href="Timesheet.html#method-i-date_for">#date_for</a>,
but pass explicitly the year, week number and day number of interest. If an
optional fourth parameter is ‘true’, returns a Date object rather than a
string.</p>
          

          
          <div class="method-source-code" id="date_for-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 413</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">date_for</span>( <span class="ruby-identifier">year</span>, <span class="ruby-identifier">week_number</span>, <span class="ruby-identifier">day_number</span>, <span class="ruby-identifier">as_date</span> = <span class="ruby-keyword">false</span> )

  <span class="ruby-comment"># Get the date of Monday, week 1 in this timesheet's year.</span>
  <span class="ruby-comment"># Add as many days as needed to get to Monday of the week</span>
  <span class="ruby-comment"># for this timesheet.</span>

  <span class="ruby-identifier">date</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_first_week_start</span>( <span class="ruby-identifier">year</span> )
  <span class="ruby-identifier">date</span> = <span class="ruby-identifier">date</span> <span class="ruby-operator">+</span> ( ( <span class="ruby-identifier">week_number</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> ) * <span class="ruby-value">7</span> )

  <span class="ruby-comment"># Add in the day number offset.</span>

  <span class="ruby-identifier">date</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">TimesheetRow</span><span class="ruby-operator">::</span><span class="ruby-constant">DAY_ORDER</span>.<span class="ruby-identifier">index</span>( <span class="ruby-identifier">day_number</span> )

  <span class="ruby-comment"># Return in DD-Mth-YYYY format, or as a Date object?</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">as_date</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">date</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>( <span class="ruby-string">'%d-%b-%Y'</span>) <span class="ruby-comment"># Or ISO: '%Y-%m-%d'</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- date_for-source -->
          
        </div>

        

        
      </div><!-- date_for-method -->

    
      <div id="method-c-get_first_week_start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_first_week_start</span><span
            class="method-args">( year )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get the date of the first day of week 1 in the given year. Note that
sometimes, this can be in December the previous year. Works on commercial
weeks (Mon-&gt;Sun). Returns a Date.</p>
          

          
          <div class="method-source-code" id="get_first_week_start-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 303</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_first_week_start</span>( <span class="ruby-identifier">year</span> )

  <span class="ruby-comment"># Is Jan 1st already in week 1?</span>

  <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span> )

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )

    <span class="ruby-comment"># Yes. Check December of the previous year.</span>

    <span class="ruby-value">31</span>.<span class="ruby-identifier">downto</span>( <span class="ruby-value">25</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> )

      <span class="ruby-comment"># If we encounter a date in the previous year which has a week</span>
      <span class="ruby-comment"># number &gt; 1, then that's the last week of the previous year. If</span>
      <span class="ruby-comment"># we're on Dec 31st that means that week 1 started on Jan 1st,</span>
      <span class="ruby-comment"># else in December on</span>

      <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> )
        <span class="ruby-keyword">return</span> ( <span class="ruby-identifier">day</span> <span class="ruby-operator">==</span> <span class="ruby-value">31</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span> ) <span class="ruby-operator">:</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> ) )
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-comment"># No. Walk forward through January until we reach week 1.</span>

    <span class="ruby-value">2</span>.<span class="ruby-identifier">upto</span>( <span class="ruby-value">7</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">day</span> )
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">date</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_first_week_start-source -->
          
        </div>

        

        
      </div><!-- get_first_week_start-method -->

    
      <div id="method-c-get_last_week_end" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_last_week_end</span><span
            class="method-args">( year )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get the date of the last day of the last week in the given year. Note that
sometimes, this can be in January in the following year. Works on
commercial weeks (Mon-&gt;Sun). Returns a Date.</p>
          

          
          <div class="method-source-code" id="get_last_week_end-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 341</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_last_week_end</span>( <span class="ruby-identifier">year</span> )

  <span class="ruby-comment"># Is Dec 31st already in week 1 for the next year?</span>

  <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> )

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )

    <span class="ruby-comment"># Yes. Check backwards through December to find the last day</span>
    <span class="ruby-comment"># in the higher week number.</span>

    <span class="ruby-value">30</span>.<span class="ruby-identifier">downto</span>( <span class="ruby-value">25</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> )
      <span class="ruby-keyword">return</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> ) <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> )
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-comment"># No. Check January of the following year to find the end</span>
    <span class="ruby-comment"># of the highest numbered week.</span>

    <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>( <span class="ruby-value">6</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">day</span> )
      <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
        <span class="ruby-keyword">return</span> ( <span class="ruby-identifier">day</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> ) <span class="ruby-operator">:</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">day</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> ) )
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_last_week_end-source -->
          
        </div>

        

        
      </div><!-- get_last_week_end-method -->

    
      <div id="method-c-get_last_week_number" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_last_week_number</span><span
            class="method-args">( year )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get the number of the last commercial week (Mon-&gt;Sun) in the given year.
This is usually 52, but is 53 for some years.</p>
          

          
          <div class="method-source-code" id="get_last_week_number-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 374</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-identifier">year</span> )

  <span class="ruby-comment"># Is Dec 31st already in week 1 for the next year?</span>

  <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> )

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )

    <span class="ruby-comment"># Yes. Check backwards through December to find the last day</span>
    <span class="ruby-comment"># in the higher week number.</span>

    <span class="ruby-value">30</span>.<span class="ruby-identifier">downto</span>( <span class="ruby-value">25</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> )
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> )
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-comment"># No, so we have the highest week already.</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_last_week_number-source -->
          
        </div>

        

        
      </div><!-- get_last_week_number-method -->

    
      <div id="method-c-used_range" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">used_range</span><span
            class="method-args">( accurate = false )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return a range of years used by all current timesheets, or the allowed
range (see above) if there are no work packets. Optionally pass ‘true’ if
you want an actual Date object range rather than just a year range.</p>
          

          
          <div class="method-source-code" id="used_range-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">used_range</span>( <span class="ruby-identifier">accurate</span> = <span class="ruby-keyword">false</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">allowed_range</span>( <span class="ruby-identifier">accurate</span> ) <span class="ruby-keyword">if</span> <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">significant</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">zero?</span>

  <span class="ruby-identifier">first</span> = <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">find_earliest_by_tasks</span>()
  <span class="ruby-identifier">last</span>  = <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">find_latest_by_tasks</span>()

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">accurate</span>
    ( <span class="ruby-identifier">first</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">to_date</span> )<span class="ruby-operator">..</span>( <span class="ruby-identifier">last</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">to_date</span> )
  <span class="ruby-keyword">else</span>
    ( <span class="ruby-identifier">first</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">year</span> )<span class="ruby-operator">..</span>( <span class="ruby-identifier">last</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">year</span> )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- used_range-source -->
          
        </div>

        

        
      </div><!-- used_range-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_row" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_row</span><span
            class="method-args">( task )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Add a row to the timesheet using the given task object. Does nothing if a
row containing that task is already present. The updated timesheet is not
saved - the caller must do this.</p>
          

          
          <div class="method-source-code" id="add_row-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 258</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_row</span>( <span class="ruby-identifier">task</span> )
  <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">task</span> )
    <span class="ruby-identifier">timesheet_row</span>      = <span class="ruby-constant">TimesheetRow</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">task</span> = <span class="ruby-identifier">task</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">timesheet_rows</span>.<span class="ruby-identifier">push</span>( <span class="ruby-identifier">timesheet_row</span> )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_row-source -->
          
        </div>

        

        
      </div><!-- add_row-method -->

    
      <div id="method-i-can_be_modified_by-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_be_modified_by?</span><span
            class="method-args">( user )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Is the given user permitted to update this timesheet?</p>
          

          
          <div class="method-source-code" id="can_be_modified_by-3F-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_be_modified_by?</span>( <span class="ruby-identifier">user</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>  <span class="ruby-keyword">if</span>     ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">admin?</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_permitted_for?</span>( <span class="ruby-identifier">user</span> ) )
  <span class="ruby-keyword">return</span> ( <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">committed</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_be_modified_by-3F-source -->
          
        </div>

        

        
      </div><!-- can_be_modified_by-3F-method -->

    
      <div id="method-i-column_sum" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">column_sum</span><span
            class="method-args">( day_number )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Count the hours across all rows on the given day number; 0 is Sunday, 1-6
Monday to Saturday.</p>
          

          
          <div class="method-source-code" id="column_sum-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 269</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">column_sum</span>( <span class="ruby-identifier">day_number</span> )
  <span class="ruby-identifier">sum</span> = <span class="ruby-value">0.0</span>

  <span class="ruby-comment"># [TODO] Slow. Surely there's a better way...?</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">timesheet_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">timesheet_row</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">work_packet</span> = <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">find_by_timesheet_row_id</span>(
      <span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:day_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">day_number</span> }
    )

    <span class="ruby-identifier">sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">worked_hours</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">work_packet</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">sum</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- column_sum-source -->
          
        </div>

        

        
      </div><!-- column_sum-method -->

    
      <div id="method-i-date_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">date_for</span><span
            class="method-args">( day_number, as_date = false )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return a date string representing this timesheet on the given day number.
Day numbers are odd - 0 = Sunday at the <strong>end</strong> of this
timesheet’s week, while 1-6 = Monday at the <strong>start</strong> of the
week through to Saturday inclusive (although this may be changed; see the
<a href="TimesheetRow.html">TimesheetRow</a> model). If an optional second
parameter is ‘true’, returns a Date object rather than a string.</p>
          

          
          <div class="method-source-code" id="date_for-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 405</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">date_for</span>( <span class="ruby-identifier">day_number</span>, <span class="ruby-identifier">as_date</span> = <span class="ruby-keyword">false</span> )
  <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">date_for</span>( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">year</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">week_number</span>, <span class="ruby-identifier">day_number</span>, <span class="ruby-identifier">as_date</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- date_for-source -->
          
        </div>

        

        
      </div><!-- date_for-method -->

    
      <div id="method-i-discover_week" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">discover_week</span><span
            class="method-args">( nextweek ) { |timesheet| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Back-end to <a
href="Timesheet.html#method-i-editable_week">#editable_week</a> and
showable_week. See those functions for details. Call with the next/previous
week boolean and pass a block; this is given a timesheet or nil; evaluate
‘true’ to return details on the item or ‘false’ to move on to the next
week.</p>
          

          
          <div class="method-source-code" id="discover_week-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">discover_week</span>( <span class="ruby-identifier">nextweek</span> )
  <span class="ruby-identifier">year</span>  = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">year</span>
  <span class="ruby-identifier">owner</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">nextweek</span> )
    <span class="ruby-identifier">inc</span>   = <span class="ruby-value">1</span>
    <span class="ruby-identifier">week</span>  = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">week_number</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">limit</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-identifier">year</span> ) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">week</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">limit</span> )
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">inc</span>   = <span class="ruby-value">-1</span>
    <span class="ruby-identifier">week</span>  = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">week_number</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">limit</span> = <span class="ruby-value">0</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">week</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">limit</span> )
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">while</span> ( <span class="ruby-identifier">week</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">limit</span> )
    <span class="ruby-identifier">timesheet</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">find_by_user_id_and_year_and_week_number</span>(
      <span class="ruby-identifier">owner</span>, <span class="ruby-identifier">year</span>, <span class="ruby-identifier">week</span>
    )

    <span class="ruby-keyword">if</span> ( <span class="ruby-keyword">yield</span>( <span class="ruby-identifier">timesheet</span> ) )
      <span class="ruby-keyword">return</span> { <span class="ruby-value">:week_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">week</span>, <span class="ruby-value">:timesheet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">timesheet</span> }
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">week</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">inc</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- discover_week-source -->
          
        </div>

        

        
      </div><!-- discover_week-method -->

    
      <div id="method-i-editable_week" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">editable_week</span><span
            class="method-args">( nextweek )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return the next (pass ‘true’) or previous (pass ‘false’) editable week
after this one, as a hash with properties ‘week_number’ and ‘timesheet’.
The latter will be populated with a timesheet if there is a not committed
item in the found week, or nil if the week has no associated timesheet yet.
Returns nil altogether if no editable week can be found (e.g. ask for
previous from week 1, or all previous weeks have committed timesheets on
them).</p>

<p>This operation may involve many database queries so is relatively slow.</p>
          

          
          <div class="method-source-code" id="editable_week-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">editable_week</span>( <span class="ruby-identifier">nextweek</span> )
  <span class="ruby-identifier">discover_week</span>( <span class="ruby-identifier">nextweek</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">timesheet</span> <span class="ruby-operator">|</span>
    ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- editable_week-source -->
          
        </div>

        

        
      </div><!-- editable_week-method -->

    
      <div id="method-i-find_mine" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_mine</span><span
            class="method-args">( conditions = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Instance method that returns an array of all timesheets owned by this user.
Pass an optional conditions hash (will be sent in as “:conditions =&gt;
&lt;given value&gt;”).</p>
          

          
          <div class="method-source-code" id="find_mine-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 154</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">conditions</span> = {} )
  <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">find_all_by_user_id</span>( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_mine-source -->
          
        </div>

        

        
      </div><!-- find_mine-method -->

    
      <div id="method-i-find_mine_committed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_mine_committed</span><span
            class="method-args">( conditions = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Instance method which returns an array of all committed timesheets owned by
this user.</p>
          

          
          <div class="method-source-code" id="find_mine_committed-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_mine_committed</span>( <span class="ruby-identifier">conditions</span> = {} )
  <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">merge!</span>( <span class="ruby-value">:committed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">conditions</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_mine_committed-source -->
          
        </div>

        

        
      </div><!-- find_mine_committed-method -->

    
      <div id="method-i-find_mine_uncommitted" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_mine_uncommitted</span><span
            class="method-args">( conditions = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Instance method which returns an array of all uncommitted timesheets owned
by this user.</p>
          

          
          <div class="method-source-code" id="find_mine_uncommitted-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_mine_uncommitted</span>( <span class="ruby-identifier">conditions</span> = {} )
  <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">merge!</span>( <span class="ruby-value">:committed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">conditions</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_mine_uncommitted-source -->
          
        </div>

        

        
      </div><!-- find_mine_uncommitted-method -->

    
      <div id="method-i-is_permitted_for-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_permitted_for?</span><span
            class="method-args">( user )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Is the given user permitted to do anything with this timesheet?</p>
          

          
          <div class="method-source-code" id="is_permitted_for-3F-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_permitted_for?</span>( <span class="ruby-identifier">user</span> )
  <span class="ruby-keyword">return</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">privileged?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_permitted_for-3F-source -->
          
        </div>

        

        
      </div><!-- is_permitted_for-3F-method -->

    
      <div id="method-i-showable_week" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">showable_week</span><span
            class="method-args">( nextweek )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>As <a href="Timesheet.html#method-i-editable_week">#editable_week</a>, but
returns weeks for ‘showable’ weeks - that is, only weeks where a timesheet
owned by the current user already exists.</p>
          

          
          <div class="method-source-code" id="showable_week-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">showable_week</span>( <span class="ruby-identifier">nextweek</span> )
  <span class="ruby-identifier">discover_week</span>( <span class="ruby-identifier">nextweek</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">timesheet</span> <span class="ruby-operator">|</span>
    ( <span class="ruby-keyword">not</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">nil?</span> )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- showable_week-source -->
          
        </div>

        

        
      </div><!-- showable_week-method -->

    
      <div id="method-i-start_day" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_day</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return the date of the first day for this timesheet as a string augmented
with week number for display purposes.</p>
          

          
          <div class="method-source-code" id="start_day-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 295</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_day</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{ self.date_for( TimesheetRow::FIRST_DAY ) } (week #{ self.week_number })&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- start_day-source -->
          
        </div>

        

        
      </div><!-- start_day-method -->

    
      <div id="method-i-total_sum" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">total_sum</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Count the total number of worked hours in the whole timesheet.</p>
          

          
          <div class="method-source-code" id="total_sum-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 288</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total_sum</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">sum</span>( <span class="ruby-value">:worked_hours</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- total_sum-source -->
          
        </div>

        

        
      </div><!-- total_sum-method -->

    
      <div id="method-i-unused_weeks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unused_weeks</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return an array of week numbers which can be assigned to the timesheet.
Includes the current timesheet’s already allocated week.</p>
          

          
          <div class="method-source-code" id="unused_weeks-source">
            <pre><span class="ruby-comment"># File app/models/timesheet.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unused_weeks</span>()
  <span class="ruby-identifier">timesheets</span> = <span class="ruby-identifier">find_mine</span>( <span class="ruby-value">:year</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">year</span> )
  <span class="ruby-identifier">used_weeks</span> = <span class="ruby-identifier">timesheets</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">hash</span>[ <span class="ruby-value">:week_number</span> ]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">range</span>        = <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">year</span> )
  <span class="ruby-identifier">unused_weeks</span> = ( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">to_a</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">used_weeks</span> )
  <span class="ruby-identifier">unused_weeks</span>.<span class="ruby-identifier">push</span>( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">week_number</span> ) <span class="ruby-keyword">unless</span> ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">week_number</span>.<span class="ruby-identifier">nil?</span> )

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">unused_weeks</span>.<span class="ruby-identifier">sort</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- unused_weeks-source -->
          
        </div>

        

        
      </div><!-- unused_weeks-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

