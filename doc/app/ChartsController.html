<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class ChartsController - TrackRecord</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/charts_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-show">#show</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./CHANGELOG_rdoc.html">CHANGELOG</a>
  
    <li class="file"><a href="./README_rdoc.html">README</a>
  
    <li class="file"><a href="./doc/README_FOR_APP_rdoc.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./TrackRecordReport.html">TrackRecordReport</a>
  
    <li><a href="./TrackRecordReport/Calculator.html">TrackRecordReport::Calculator</a>
  
    <li><a href="./TrackRecordReport/CalculatorWithUsers.html">TrackRecordReport::CalculatorWithUsers</a>
  
    <li><a href="./TrackRecordReport/Cell.html">TrackRecordReport::Cell</a>
  
    <li><a href="./TrackRecordReport/Report.html">TrackRecordReport::Report</a>
  
    <li><a href="./TrackRecordReport/Row.html">TrackRecordReport::Row</a>
  
    <li><a href="./TrackRecordReport/Section.html">TrackRecordReport::Section</a>
  
    <li><a href="./TrackRecordSections.html">TrackRecordSections</a>
  
    <li><a href="./TrackRecordSections/Group.html">TrackRecordSections::Group</a>
  
    <li><a href="./TrackRecordSections/GroupMixin.html">TrackRecordSections::GroupMixin</a>
  
    <li><a href="./TrackRecordSections/Section.html">TrackRecordSections::Section</a>
  
    <li><a href="./TrackRecordSections/SectionMixin.html">TrackRecordSections::SectionMixin</a>
  
    <li><a href="./TrackRecordSections/Sections.html">TrackRecordSections::Sections</a>
  
    <li><a href="./TrackRecordSections/SectionsMixin.html">TrackRecordSections::SectionsMixin</a>
  
    <li><a href="./ReportsHelper.html">ReportsHelper</a>
  
    <li><a href="./ReportsHelper/ReportMonth.html">ReportsHelper::ReportMonth</a>
  
    <li><a href="./ReportsHelper/ReportWeek.html">ReportsHelper::ReportWeek</a>
  
    <li><a href="./ReportsHelper/ReportYear.html">ReportsHelper::ReportYear</a>
  
    <li><a href="./QuietLeightbox.html">QuietLeightbox</a>
  
    <li><a href="./QuietLeightbox/ClassMethods.html">QuietLeightbox::ClassMethods</a>
  
    <li><a href="./QuietLeightbox/QuietLeightboxHelper.html">QuietLeightbox::QuietLeightboxHelper</a>
  
    <li><a href="./QuietPrototype.html">QuietPrototype</a>
  
    <li><a href="./QuietPrototype/ClassMethods.html">QuietPrototype::ClassMethods</a>
  
    <li><a href="./QuietPrototype/QuietPrototypeHelper.html">QuietPrototype::QuietPrototypeHelper</a>
  
    <li><a href="./YuiTree.html">YuiTree</a>
  
    <li><a href="./YuiTree/ClassMethods.html">YuiTree::ClassMethods</a>
  
    <li><a href="./YuiTree/YuiTreeHelper.html">YuiTree::YuiTreeHelper</a>
  
    <li><a href="./TrackRecordReportGenerator.html">TrackRecordReportGenerator</a>
  
    <li><a href="./TrackRecordReportGenerator/UkOrgPondCSV.html">TrackRecordReportGenerator::UkOrgPondCSV</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./AuditsController.html">AuditsController</a>
  
    <li><a href="./AuditsHelper.html">AuditsHelper</a>
  
    <li><a href="./ChartsController.html">ChartsController</a>
  
    <li><a href="./ChartsHelper.html">ChartsHelper</a>
  
    <li><a href="./ControlPanel.html">ControlPanel</a>
  
    <li><a href="./ControlPanelsController.html">ControlPanelsController</a>
  
    <li><a href="./Customer.html">Customer</a>
  
    <li><a href="./CustomersController.html">CustomersController</a>
  
    <li><a href="./CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="./EmailNotifier.html">EmailNotifier</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HelpHelper.html">HelpHelper</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectsController.html">ProjectsController</a>
  
    <li><a href="./ProjectsHelper.html">ProjectsHelper</a>
  
    <li><a href="./Rangeable.html">Rangeable</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SavedReport.html">SavedReport</a>
  
    <li><a href="./SavedReportAutoTitlesController.html">SavedReportAutoTitlesController</a>
  
    <li><a href="./SavedReportsBaseController.html">SavedReportsBaseController</a>
  
    <li><a href="./SavedReportsByCustomerController.html">SavedReportsByCustomerController</a>
  
    <li><a href="./SavedReportsByProjectController.html">SavedReportsByProjectController</a>
  
    <li><a href="./SavedReportsByTaskController.html">SavedReportsByTaskController</a>
  
    <li><a href="./SavedReportsByUserController.html">SavedReportsByUserController</a>
  
    <li><a href="./SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="./SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="./SessionsController.html">SessionsController</a>
  
    <li><a href="./SignIn.html">SignIn</a>
  
    <li><a href="./Task.html">Task</a>
  
    <li><a href="./TaskGroup.html">TaskGroup</a>
  
    <li><a href="./TaskImport.html">TaskImport</a>
  
    <li><a href="./TaskImportsController.html">TaskImportsController</a>
  
    <li><a href="./TaskImportsHelper.html">TaskImportsHelper</a>
  
    <li><a href="./TasksController.html">TasksController</a>
  
    <li><a href="./TasksHelper.html">TasksHelper</a>
  
    <li><a href="./Timesheet.html">Timesheet</a>
  
    <li><a href="./TimesheetForceCommit.html">TimesheetForceCommit</a>
  
    <li><a href="./TimesheetForceCommitsController.html">TimesheetForceCommitsController</a>
  
    <li><a href="./TimesheetRow.html">TimesheetRow</a>
  
    <li><a href="./TimesheetRowsController.html">TimesheetRowsController</a>
  
    <li><a href="./TimesheetRowsHelper.html">TimesheetRowsHelper</a>
  
    <li><a href="./TimesheetsController.html">TimesheetsController</a>
  
    <li><a href="./TimesheetsHelper.html">TimesheetsHelper</a>
  
    <li><a href="./TreesController.html">TreesController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WorkPacket.html">WorkPacket</a>
  
    <li><a href="./WorkPacketsController.html">WorkPacketsController</a>
  
    <li><a href="./WorkPacketsHelper.html">WorkPacketsHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ChartsController</h1>

  <div id="description" class="description">
    <dl class="rdoc-list note-list"><dt>File
<dd>
<p>charts_controller.rb</p>
</dd><dt>(C)
<dd>
<p>Hipposoft 2008</p>
</dd><dt>Purpose
<dd>
<p>Use the Gruff library to generate charts in PNG format for inclusion in
HTML reports.</p>
</dd></dl>
<hr style="height: 10px">

<pre>11-Mar-2008 (ADH): Created.</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Show a graph. See charts_helper.rb for the way to generate a URL that will
correctly convey the required parameters. Essentially, the ID is used to
carry the chart type and extra query string parameters carry additional
required parameters. This is more of a ‘create’ action than ‘show’, but
since it’s used for things like showing reports and the charts are usually
generated on-demand as part of IMG tags, it is far more natural from the
caller’s perspective to use ‘show’.</p>
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/charts_controller.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>

  <span class="ruby-comment"># Extract the request parameters</span>

  <span class="ruby-identifier">type</span> = <span class="ruby-identifier">params</span>[ <span class="ruby-value">:id</span> ]

  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Chart type #{type} is unknown&quot;</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">ChartsHelper</span><span class="ruby-operator">::</span><span class="ruby-constant">CHART_TYPE_PIE</span>.<span class="ruby-identifier">to_s</span> )

  <span class="ruby-identifier">leaf</span>          = ( <span class="ruby-identifier">params</span>[ <span class="ruby-value">:leaf</span>          ] <span class="ruby-operator">||</span> <span class="ruby-string">'chart'</span> )
  <span class="ruby-identifier">width</span>         = ( <span class="ruby-identifier">params</span>[ <span class="ruby-value">:width</span>         ] <span class="ruby-operator">||</span> <span class="ruby-string">'128'</span>   ).<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">duration</span>      = ( <span class="ruby-identifier">params</span>[ <span class="ruby-value">:duration</span>      ] <span class="ruby-operator">||</span> <span class="ruby-string">'1_0'</span>   ).<span class="ruby-identifier">sub</span>( <span class="ruby-string">'_'</span>, <span class="ruby-string">'.'</span> ).<span class="ruby-identifier">to_f</span>
  <span class="ruby-identifier">committed</span>     = ( <span class="ruby-identifier">params</span>[ <span class="ruby-value">:committed</span>     ] <span class="ruby-operator">||</span> <span class="ruby-string">'0_2'</span>   ).<span class="ruby-identifier">sub</span>( <span class="ruby-string">'_'</span>, <span class="ruby-string">'.'</span> ).<span class="ruby-identifier">to_f</span>
  <span class="ruby-identifier">not_committed</span> = ( <span class="ruby-identifier">params</span>[ <span class="ruby-value">:not_committed</span> ] <span class="ruby-operator">||</span> <span class="ruby-string">'0_5'</span>   ).<span class="ruby-identifier">sub</span>( <span class="ruby-string">'_'</span>, <span class="ruby-string">'.'</span> ).<span class="ruby-identifier">to_f</span>
  <span class="ruby-identifier">remaining</span>     = <span class="ruby-identifier">duration</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">committed</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">not_committed</span>

  <span class="ruby-comment"># Stop silly widths from loading the server unnecessarily.</span>

  <span class="ruby-identifier">width</span> = <span class="ruby-value">40</span>  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">width</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">40</span>  );
  <span class="ruby-identifier">width</span> = <span class="ruby-value">640</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">width</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">640</span> );

  <span class="ruby-identifier">g</span>                  = <span class="ruby-constant">Gruff</span><span class="ruby-operator">::</span><span class="ruby-constant">Mini</span><span class="ruby-operator">::</span><span class="ruby-constant">Pie</span>.<span class="ruby-identifier">new</span>( <span class="ruby-node">&quot;#{ width }x#{ width * 0.75 }&quot;</span> )
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">title</span>            = <span class="ruby-string">'Chart'</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">font</span>             = <span class="ruby-node">&quot;#{ Rails.root }/#{ GRAPH_FONT }&quot;</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">hide_legend</span>      = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">hide_title</span>       = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">marker_font_size</span> = <span class="ruby-value">70</span>

  <span class="ruby-comment"># Is this a normal or overrun graph?</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">remaining</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">duration</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> )

    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">theme</span> = {
      <span class="ruby-value">:colors</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w( #cc7777 #ffaa77 #99ff99 )</span>,
      <span class="ruby-value">:background_colors</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w( white   white           )</span>,
      <span class="ruby-value">:marker_color</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'black'</span>
    }

    <span class="ruby-comment"># Can't have a pie chart where every entry has zero size;</span>
    <span class="ruby-comment"># set the remaining time to 100 (as in, 100%) in that case.</span>

    <span class="ruby-identifier">remaining</span> = <span class="ruby-value">0</span>   <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">remaining</span>  <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> ) <span class="ruby-comment"># Zero duration task</span>
    <span class="ruby-identifier">remaining</span> = <span class="ruby-value">100</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">remaining</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">committed</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">not_committed</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> )

    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">data</span>( <span class="ruby-string">'Committed'</span>,     <span class="ruby-identifier">committed</span>     )
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">data</span>( <span class="ruby-string">'Not committed'</span>, <span class="ruby-identifier">not_committed</span> )
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">data</span>( <span class="ruby-string">'Remaining'</span>,     <span class="ruby-identifier">remaining</span>     )

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">theme</span> = {
      <span class="ruby-value">:colors</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w( #ffaa77 #880000 #000000 )</span>,
      <span class="ruby-value">:background_colors</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w( white   white           )</span>,
      <span class="ruby-value">:marker_color</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'black'</span>
    }

    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">data</span>( <span class="ruby-string">'Duration'</span>, <span class="ruby-identifier">duration</span>   )
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">data</span>( <span class="ruby-string">'Overrun'</span>,  <span class="ruby-operator">-</span><span class="ruby-identifier">remaining</span> )
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">data</span>( <span class="ruby-string">'-'</span>, <span class="ruby-value">0</span> )

  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Start the chart at 12:00</span>

  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">zero_degree</span> = <span class="ruby-value">-90</span>

  <span class="ruby-comment"># Send out the result</span>

  <span class="ruby-identifier">send_data</span>(
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">to_blob</span>,
    <span class="ruby-value">:disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'inline'</span>,
    <span class="ruby-value">:type</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'image/png'</span>,
    <span class="ruby-value">:filename</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{ leaf }.png&quot;</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div><!-- show-source -->
          
        </div>

        

        
      </div><!-- show-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

